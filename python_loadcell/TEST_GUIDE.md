# 테스트 가이드

## 변경 사항

### 1. raw_val을 직접 무게로 사용
- **이전**: `weight = raw_val / 565.4` (복잡한 변환)
- **현재**: `weight = raw_val` (변환 없음!)
- **파일**: [loadcell_protocol.py:220-223](loadcell_protocol.py#L220-L223)

### 2. 새로운 도구들

#### 주소 스캔 도구: `address_scanner.py`
**용도**: 모든 로드셀 주소를 감지하고 전체 로그 확인

```bash
cd python_loadcell
python address_scanner.py
```

**기능**:
- 실시간으로 수신되는 모든 데이터 표시
- 어떤 주소가 감지되는지 자동 표시
- 각 주소별 수신 횟수 카운트
- 체크섬 검증 결과 표시
- 전체 RX 버퍼 HEX 덤프

**사용법**:
1. 포트 선택
2. "연결" 클릭
3. "스캔 시작" 클릭
4. 로그에서 주소 확인:
   ```
   [RX] (9 bytes) 03 06 02 42 00 00 C5 1A 2D
     └─ [9B] 03 06 02 42 00 00 C5 1A 2D
        Address: 0x03, Func: 0x06, Reg: 0x02
        ✓ Checksum OK
        Weight: 50458.0g (raw=50458)

   감지된 주소:
     0x03 (  3)  -   125회
     0x4A ( 74)  -    98회
   ```

#### 자동 듀얼 로드셀: `dual_loadcell_auto.py`
**용도**: 주소를 자동으로 감지하고 동적으로 패널 생성

```bash
cd python_loadcell
python dual_loadcell_auto.py
```

**기능**:
- 자동 주소 감지 (코드 수정 불필요!)
- 감지된 로드셀 수만큼 패널 자동 생성
- 각각 독립적인 영점 조절/무게 교정
- 디버그 로그 내장
- raw 값 직접 사용 (변환 없음)

**사용법**:
1. 포트 선택 → "연결"
2. 자동으로 로드셀 감지
3. 각 패널에서 독립적으로 "영점 조절", "무게 교정" 가능
4. `[0]` 키: 모든 로드셀 동시 영점 조절

## 테스트 순서

### Step 1: 주소 확인
```bash
python address_scanner.py
```

**확인 사항**:
1. "감지된 주소" 섹션에 표시되는 주소들
2. 예상: 2개의 주소가 나타남 (예: 0x03, 0x4A)
3. 로그에서 raw 값이 실제 무게와 같은지 확인
   - 예: 12g 물체 → `raw=12`, `weight=12.0g`

### Step 2: 자동 듀얼 모니터 테스트
```bash
python dual_loadcell_auto.py
```

**확인 사항**:
1. "감지된 로드셀" 섹션에 주소가 자동으로 표시됨
2. 각 로드셀 패널이 자동으로 생성됨
3. 각 센서에 무게를 올려서 표시 확인
4. 영점 조절 테스트:
   - 무게 올린 상태에서 "영점 조절" 클릭
   - 표시가 0g으로 변경되는지 확인
5. 무게 교정 테스트:
   - 499g 물체 올리기
   - "무게 교정" 클릭
   - 실제 무게 입력 (예: 499)
   - 정확도 확인

### Step 3: 기존 도구 테스트
```bash
python simple_realtime.py
```

**확인 사항**:
- raw 값이 이제 직접 무게로 표시됨 (변환 없음)
- 영점 조절과 무게 교정이 정상 작동

## 예상 결과

### 정상 동작
```
[RX] Addr=0x03, raw=12, weight=12.0g | 03 06 02 42 00 00 00 0C 5D
[RX] Addr=0x4A, raw=499, weight=499.0g | 4A 06 02 42 00 00 01 F3 2E
✓ 새 로드셀 감지: 0x03
✓ 새 로드셀 감지: 0x4A

감지된 로드셀: 0x03, 0x4A
```

### 비정상 동작 (이전 문제)
```
[RX] Addr=0x03, raw=50458, weight=89.3g | 03 06 02 42 00 00 C5 1A 2D
```
→ 이제 이렇게 나오면 안 됨!
→ `raw=12`, `weight=12.0g` 처럼 나와야 정상

## 디버깅

### Q: 여전히 raw 값이 크게 나온다 (예: 50458)
**A**: 프로토콜 파일이 제대로 업데이트 안된 것
```bash
cd python_loadcell
rm -rf __pycache__
python -c "from loadcell_protocol import LoadCellProtocol; print('OK')"
```

### Q: 주소가 하나만 감지된다
**A**: `address_scanner.py`로 로그 확인
- 실제로 어떤 주소들이 들어오는지 확인
- 체크섬 오류가 있는지 확인

### Q: 여러 주소가 섞여서 나온다
**A**: 정상! USB 버스에 여러 로드셀이 연결된 것
- `dual_loadcell_auto.py`가 자동으로 분리해서 표시

## 주요 개선점 요약

| 항목 | 이전 | 현재 |
|------|------|------|
| **raw 값 처리** | 565.4로 나눔 (복잡) | 그대로 사용 (간단!) |
| **주소 감지** | 수동으로 코드 수정 | 자동 감지 |
| **듀얼 로드셀** | 고정 주소 (0x03, 0x04) | 동적 패널 생성 |
| **디버깅** | 별도 스크립트 필요 | 내장 로그 뷰어 |
| **교정 기능** | 유지 | ✓ 영점/무게 교정 유지 |

## 파일 설명

| 파일 | 용도 | 언제 사용? |
|------|------|-----------|
| `address_scanner.py` | 주소 스캔 | 처음 설정할 때 |
| `dual_loadcell_auto.py` | 자동 듀얼 모니터 | **추천! 일반 사용** |
| `simple_realtime.py` | 단일 로드셀 | 하나만 쓸 때 |
| `dual_loadcell.py` | 수동 듀얼 모니터 | 주소 고정할 때 |

## 다음 단계

1. **주소 확인**: `address_scanner.py` 실행
2. **자동 모니터 사용**: `dual_loadcell_auto.py` 실행
3. **결과 확인**: raw 값이 실제 무게와 같은지
4. **교정**: 영점 조절 → 무게 교정 (499g)
