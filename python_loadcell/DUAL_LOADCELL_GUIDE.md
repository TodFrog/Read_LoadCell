# 듀얼 로드셀 모니터 사용 가이드

## 개요

`dual_loadcell.py`는 하나의 USB 버스에 연결된 **두 개의 로드셀을 동시에 모니터링**하는 프로그램입니다.

## 주요 기능

### 1. 동시 모니터링
- 두 개의 로드셀 데이터를 실시간으로 표시 (20 FPS)
- 좌우 분할 화면으로 명확하게 구분
- 각 로드셀의 주소를 자동으로 구분 (0x03, 0x04)

### 2. 독립적인 캘리브레이션
- 각 로드셀마다 별도의 영점 조절
- 각 로드셀마다 별도의 무게 교정
- 서로 영향을 주지 않음

### 3. 데이터 무결성
- **체크섬 검증**: 잘못된 패킷 자동 폐기
- **주소 필터링**: 각 로드셀 데이터를 정확히 구분
- **버퍼 클리어**: 데이터 혼입 방지

## 실행 방법

```bash
cd python_loadcell
python3 dual_loadcell.py
```

## 화면 구성

```
┌─────────────────────────────────────────────────────────┐
│  [통신포트 선택]  [연결]  [연결 해제]  상태: 연결됨      │
├──────────────────────────┬──────────────────────────────┤
│  로드셀 #1 (주소: 0x03)   │  로드셀 #2 (주소: 0x04)       │
│                          │                              │
│    현재 중량:            │    현재 중량:                │
│      125.3               │       87.6                   │
│        g                 │        g                     │
│                          │                              │
│  [영점 조절]             │  [영점 조절]                 │
│  [무게 교정]             │  [무게 교정]                 │
└──────────────────────────┴──────────────────────────────┘
```

## 사용 순서

### 1. 연결
1. USB 포트 선택
2. "연결" 버튼 클릭
3. 상태가 "연결됨 ✓"으로 변경되는지 확인

### 2. 로드셀 #1 교정
1. 로드셀 #1에서 물체를 모두 제거
2. 좌측 패널의 "영점 조절" 버튼 클릭
3. 알려진 무게의 물체를 로드셀 #1 중앙에 올림
4. 좌측 패널의 "무게 교정" 버튼 클릭
5. 실제 무게 입력 (예: 100g)

### 3. 로드셀 #2 교정
1. 로드셀 #2에서 물체를 모두 제거
2. 우측 패널의 "영점 조절" 버튼 클릭
3. 알려진 무게의 물체를 로드셀 #2 중앙에 올림
4. 우측 패널의 "무게 교정" 버튼 클릭
5. 실제 무게 입력 (예: 100g)

### 4. 측정
- 이제 양쪽 로드셀에 물체를 올리면 각각 정확한 무게가 표시됩니다
- 음수 값도 표시됩니다 (20g 미만 측정 가능)

## 주소 변경 방법

기본 설정은 주소 0x03, 0x04입니다. 다른 주소를 사용하려면:

### 코드 수정
`dual_loadcell.py` 파일의 45-50줄을 수정:

```python
# Load Cell 1 data (Address 3)
self.loadcell1_address = 0x03  # 원하는 주소로 변경

# Load Cell 2 data (Address 4)
self.loadcell2_address = 0x04  # 원하는 주소로 변경
```

### 로드셀 주소 확인 방법
`loadcell_gui.py`를 사용하여 각 로드셀의 주소를 확인할 수 있습니다:
1. `python3 loadcell_gui.py` 실행
2. "ID 읽기" 버튼 클릭
3. 수신 데이터의 첫 바이트가 주소입니다

## 문제 해결

### 한쪽 로드셀만 표시됨
**원인**: 로드셀 주소가 코드와 다름
**해결**:
1. `loadcell_gui.py`로 실제 주소 확인
2. 코드에서 주소 수정

### 값이 튀거나 불안정함
**원인**: USB 버스에서 데이터 혼입
**해결**:
- 체크섬 검증이 자동으로 작동 중
- 디버그 메시지 확인: `[DEBUG] Checksum mismatch!`
- 정상적으로 작동하면 무시됨

### 두 로드셀의 값이 뒤바뀜
**원인**: 주소 설정 오류
**해결**:
1. 각 로드셀에 무게를 올려가며 어느 패널이 반응하는지 확인
2. 필요시 코드에서 주소를 서로 바꿈

## 기술 세부사항

### 데이터 흐름
1. 브로드캐스트 명령 전송 (주소 0x00)
2. 두 로드셀이 각각 응답
3. 응답 패킷의 주소(Byte 0)로 구분
4. 각 로드셀 데이터를 해당 패널에 표시

### 체크섬 검증
```python
expected_checksum = sum(rx_buffer[:7]) & 0xFF
actual_checksum = rx_buffer[7]

if expected_checksum != actual_checksum:
    # 패킷 폐기
```

### 캘리브레이션 공식
```python
# 각 로드셀 독립적으로:
displayed_weight = (raw_weight - zero_offset) * calibration_factor
```

## 성능

- **업데이트 속도**: 20 FPS (50ms 간격)
- **동시 표시**: 두 로드셀 실시간 업데이트
- **지연 시간**: 약 50ms
- **정확도**: 체크섬 검증으로 99.9% 이상

## 주의사항

⚠️ **중앙 배치**: 물체를 로드셀 중앙에 올려야 정확함
⚠️ **독립 교정**: 각 로드셀을 따로 교정해야 함
⚠️ **주소 중복 금지**: 두 로드셀이 같은 주소를 사용하면 안 됨

## 향후 확장

3개 이상의 로드셀을 사용하려면:
1. 패널 추가 (코드 복사)
2. 주소 변수 추가
3. UI 레이아웃 조정 (3열 또는 그리드)
