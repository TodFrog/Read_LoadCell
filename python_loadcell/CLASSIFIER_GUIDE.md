# 상품 분류 시스템 사용 가이드

## 개요

`product_classifier.py`는 로드셀을 이용하여 상품의 추가/제거를 자동으로 감지하고 기록하는 시스템입니다.

## 실행 방법

```bash
cd python_loadcell
python product_classifier.py
```

## 주요 기능

### 1. 안정 상태 감지
- **같은 무게가 N번 반복**되면 "안정 상태"로 판단
- 안정 상태에서 다음 안정 상태로 변할 때 무게 변화 감지
- ±1g 허용 오차: 오류로 인한 작은 변화는 같은 무게로 간주

### 2. 상품 추가/제거 감지
- **추가**: 무게가 증가하면 → "✓ Xg 추가" 표시
- **제거**: 무게가 감소하면 → "✗ Xg 제거" 표시
- 화면과 txt 파일 모두에 기록

### 3. 자동 로깅
- **파일**: `product_log.txt`
- **형식**:
  ```
  id.1 67g (추가) - 2025-10-29 14:23:45
  id.2 80g (추가) - 2025-10-29 14:24:10
  id.3 67g (제거) - 2025-10-29 14:25:30
  id.4 120g (추가) - 2025-10-29 14:26:05
  ```

## 튜닝 파라미터

### 상단 "튜닝 파라미터" 섹션에서 조정 가능:

#### 1. 안정 상태 판단 횟수 (기본값: 5)
- **의미**: 같은 무게가 몇 번 반복되어야 안정 상태로 볼 것인가?
- **기본값**: 5회
- **추천 범위**: 3~10회
- **값이 작으면**: 빠른 반응, 오감지 가능성 증가
- **값이 크면**: 느린 반응, 안정적

#### 2. 무게 허용 오차 (기본값: ±1g)
- **의미**: 몇 그램 차이까지 "같은 무게"로 볼 것인가?
- **기본값**: ±1g
- **추천 범위**: 0~5g
- **값이 작으면**: 민감하게 반응
- **값이 크면**: 작은 무게 변화 무시

## 사용 시나리오

### 초기 설정
1. 프로그램 실행: `python product_classifier.py`
2. 포트 선택 → "연결" 클릭
3. 빈 상태에서 "영점 조절" 클릭
4. (선택) 499g 추 올려서 "무게 교정" 클릭

### 상품 분류 작업

#### 예시 1: 상품 추가
```
[초기 상태]
현재 무게: 0.0g
상태: 안정 (0.0g)

[상품 A를 올림 - 67g]
현재 무게: 변화 중...
상태: 변화 감지 중...

[5회 같은 무게 감지]
현재 무게: 67.0g
상태: 안정 (67.0g)
✓ 67.0g 추가

파일 기록:
id.1 67.0g (추가) - 2025-10-29 14:23:45
```

#### 예시 2: 추가 후 또 추가
```
[현재 상태]
현재 무게: 67.0g
상태: 안정 (67.0g)

[상품 B를 추가로 올림 - 80g]
현재 무게: 변화 중...
상태: 변화 감지 중...

[5회 같은 무게 감지]
현재 무게: 147.0g
상태: 안정 (147.0g)
✓ 80.0g 추가

파일 기록:
id.1 67.0g (추가) - 2025-10-29 14:23:45
id.2 80.0g (추가) - 2025-10-29 14:24:10
```

#### 예시 3: 상품 제거
```
[현재 상태]
현재 무게: 147.0g
상태: 안정 (147.0g)

[상품 A를 제거 - 67g]
현재 무게: 변화 중...
상태: 변화 감지 중...

[5회 같은 무게 감지]
현재 무게: 80.0g
상태: 안정 (80.0g)
✗ 67.0g 제거

파일 기록:
id.1 67.0g (추가) - 2025-10-29 14:23:45
id.2 80.0g (추가) - 2025-10-29 14:24:10
id.3 67.0g (제거) - 2025-10-29 14:25:30
```

## 화면 구성

```
┌─────────────────────────────────────────────────┐
│ 튜닝 파라미터                                    │
│ 안정 상태 판단 횟수: [5] 무게 허용 오차: [±1g] │
├─────────────────────────────────────────────────┤
│ 연결 설정                                        │
│ [포트 선택] [새로고침] [연결] 상태: 연결됨      │
├─────────────────────────────────────────────────┤
│ 현재 무게                                        │
│                                                  │
│              67.0                                │
│                g                                 │
│                                                  │
│        상태: 안정 (67.0g)                        │
├─────────────────────────────────────────────────┤
│ [영점 조절] [무게 교정] [기록 초기화]           │
├─────────────────────────────────────────────────┤
│ 무게 변화 감지                                   │
│ [14:23:45] ✓ 67.0g 추가                         │
│ [14:24:10] ✓ 80.0g 추가                         │
│ [14:25:30] ✗ 67.0g 제거                         │
├─────────────────────────────────────────────────┤
│ 상품 기록 (product_log.txt)                     │
│ id.1 67.0g (추가) - 2025-10-29 14:23:45         │
│ id.2 80.0g (추가) - 2025-10-29 14:24:10         │
│ id.3 67.0g (제거) - 2025-10-29 14:25:30         │
└─────────────────────────────────────────────────┘
```

## 동작 원리

### 안정 상태 감지 알고리즘

```python
# 최근 N개의 무게 측정값 저장
weight_history = [66.8, 67.1, 67.0, 66.9, 67.2]

# 평균 계산
avg = 67.0g

# 모든 값이 평균 ± tolerance 범위 내?
all_stable = all(abs(w - avg) <= 1.0 for w in weight_history)

if all_stable:
    # 안정 상태!
    stable_weight = 67.0g
```

### 무게 변화 감지

```python
# 이전 안정 상태: 0.0g
# 현재 안정 상태: 67.0g
change = 67.0 - 0.0 = +67.0g

if change > tolerance:
    # 추가!
    log("✓ 67.0g 추가")
```

## 튜닝 가이드

### 상황 1: 너무 민감하게 반응 (오감지)
**증상**: 무게가 안정되지 않았는데 추가/제거로 인식
**해결**:
- "안정 상태 판단 횟수" 증가 (5 → 7 또는 10)
- "무게 허용 오차" 증가 (1g → 2g)

### 상황 2: 반응이 너무 느림
**증상**: 상품을 올려도 한참 뒤에 인식
**해결**:
- "안정 상태 판단 횟수" 감소 (5 → 3)

### 상황 3: 작은 무게 변화를 놓침
**증상**: 10g 이하의 가벼운 상품이 감지 안됨
**해결**:
- "무게 허용 오차" 감소 (1g → 0g)
- 영점 조절과 무게 교정 다시 수행

### 상황 4: 무게가 1g씩 왔다갔다
**증상**: 67g, 68g, 67g, 68g 반복
**해결**:
- 정상! "무게 허용 오차 ±1g" 설정으로 67~68g를 같은 무게로 인식
- 더 안정적으로: "무게 허용 오차" 2g로 증가

## 키보드 단축키

- **`[0]` 키**: 영점 조절 (빠른 영점 설정)

## 주의사항

1. **영점 조절 필수**: 시작 전 반드시 빈 상태에서 영점 조절
2. **무게 교정 권장**: 정확한 무게 측정을 위해 교정 추천
3. **안정된 환경**: 진동이 적은 곳에서 사용
4. **기록 백업**: `product_log.txt` 파일 정기적으로 백업

## 트러블슈팅

### Q: "상태: 데이터 수집 중..." 에서 계속 멈춤
A: 정상! 처음 N회 측정까지 기다려야 함

### Q: 추가했는데 제거로 인식됨 (또는 그 반대)
A: 영점 조절 다시 수행

### Q: 무게가 계속 변화 감지 중...
A: 센서가 불안정. "안정 상태 판단 횟수" 증가

### Q: product_log.txt 파일이 안 열림
A: 프로그램 종료 후 메모장으로 열기

## 코드 커스터마이징

파일 상단의 튜닝 파라미터를 직접 수정 가능:

```python
# ============================================================
# 튜닝 가능한 파라미터 (TUNABLE PARAMETERS)
# ============================================================
STABLE_COUNT_THRESHOLD = 5  # 안정 상태 판단: 같은 무게가 N번 반복되면 안정
WEIGHT_TOLERANCE = 1.0      # 무게 허용 오차: ±1g는 같은 무게로 간주
# ============================================================
```

또는 GUI에서 실시간으로 조정 가능!

## 데이터 분석

`product_log.txt` 파일은 일반 텍스트 파일이므로:
- Excel로 불러오기 (공백으로 구분)
- Python으로 분석
- 텍스트 에디터로 직접 확인

## 추가 기능 아이디어

- [ ] 상품별 무게 데이터베이스 연동
- [ ] 특정 무게 범위를 상품 종류로 분류
- [ ] 통계: 시간당 처리량, 평균 무게 등
- [ ] 경고음: 비정상 무게 감지 시
- [ ] CSV 내보내기
